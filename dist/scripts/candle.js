var Candle=function(){this._about="This project is based on candle.js",this.setCanvas({}),this._entities=[],this._images=[],this._jsons=[],this._sounds=[],this._imageFiles=["sky1.jpg","wall_texture.jpg","tiles.png","artifacts.png","gangnam.png"],this._imageFoler="images/",this._jsonFiles=["levels.json","Wolf08.json","artifacts.json","gangnamAtlas.json","gangnamLevel.json","gangnamAnimations.json"],this._jsonFolder="jsons/",this._scriptFiles=["input.js","loop.js","level.js","entity.js","artifact.js","bot.js","god.js","sky.js","plane.js","camera.js","player.js"],this._scriptFolder="scripts/"};Candle.PPU=128,Candle.prototype={get scriptSrcs(){var t=this,n=$.map(this._scriptFiles,function(n){return t._scriptFolder+n});return n},get imageFolder(){return this._imageFoler},get imageFiles(){return this._imageFiles},get jsonFiles(){return this._jsonFiles},get jsonFolder(){return this._jsonFolder},get imageSrcs(){var t=this,n=$.map(this._imageFiles,function(n){return t._imageFoler+n});return n},get canvas(){return this._canvas},get images(){return this._images},get jsons(){return this._jsons},get ctx(){return this._ctx}},Candle.prototype.setCanvas=function(t){this._canvas=document.getElementById(t.id||"display"),this._canvas.width=t.width||640,this._canvas.height=t.height||480,this._canvas.style.display="block",this._canvas.style.margin="auto",this._canvas.style.background="#f0f0f0",this._ctx=this._canvas.getContext("2d")},Candle.prototype.about=function(){console.log(this._about)},Candle.prototype.init=function(t){this._scripts.push.apply(this._scripts,t)},Candle.prototype.loadScripts=function(t,n){var e=0,s=t[e],i=function(){++e===t.length?n():(s=t[e],loadJS(s,i))};loadJS(s,i)},Candle.prototype.loadImages=function(t,n,e){for(var s=n.length,i=function(){s--,0===s&&e()},a=0;a<n.length;a++){var o=new Image,r=n[a];this._images[r]=o,o.onload=i,o.src=t+r}},Candle.prototype.loadJsons=function(t,n,e){for(var s=n.length,i=this,a=function(){i._jsons[this.fileName]=JSON.parse(this.responseText),s--,0===s&&e()},o=0;o<n.length;o++){var r=n[o],c=t+r,l=new XMLHttpRequest;l.fileName=r,l.onload=a,l.open("GET",c),l.send()}},Candle.prototype.load=function(){var t=this;t.about(),t.loadScripts(t.scriptSrcs,function(){t.loadImages(t.imageFolder,t.imageFiles,function(){t.loadJsons(t.jsonFolder,t.jsonFiles,function(){t.wolf3d()})})})},Candle.prototype.render=function(t,n){function e(t,n){return t.distance<n.distance?1:t.distance>n.distance?-1:0}var s=this.ctx,i=[];for(var a in t){var o=t[a];o&&i.push(o)}for(var r in n){var c=n[r];c&&i.push(c)}i.sort(e);for(var l in i){var g=i[l];s.drawImage(g.texture,g.sx,g.sy,g.sw,g.sh,g.dx,g.dy,g.dw,g.dh)}},Candle.prototype.wolf3d=function(){var t=this.jsons["gangnamLevel.json"],n=new Input,e=new Loop,s=new Player("larry");s.setPosition(12,12),s.setTheta(Math.PI),s.control=function(){var t=n.states,e=.005*(t.up-t.down),s=.002*(t.right-t.left);this.setOmega(s),this.setSpeed(e)};for(var i=this.canvas,a=new Plane(i,t.ceiling,t.floor,this.images["tiles.png"],64,t.grids),o=new Camera(i,2,32,.8,a),r={info:this.jsons["artifacts.json"],texture:this.images["artifacts.png"]},c={500:{name:"Gangnam",tag:500,texture:this.images["gangnam.png"],atlas:this.jsons["gangnamAtlas.json"],animations:this.jsons["gangnamAnimations.json"]}},l=new God(i,r,c,64,t.grids),g=l.bots,h=0;h<g.length;h++){var d=g[h];500===d.tag&&d.setAnimation("step1")}s.bindActionKey("space",1e3,function(){l.render()}),e.start(function(t){s.control(),s.motion(t),s.onActionKey("space",n.states.space,t),a.render(),o.castRays(s,a),l.animate(t),l.viewFrom(s,.8);var e=o.render(),i=l.render();this.render(e,i)}.bind(this))};