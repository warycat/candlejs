var Candle=function(){this._about="This project is based on candle.js",this.setCanvas({}),this._entities=[],this._images=[],this._jsons=[],this._sounds=[],this._imageFiles=["sky1.jpg","wall_texture.jpg","tiles.png","artifacts.png"],this._imageFoler="images/",this._jsonFiles=["levels.json","Wolf08.json","artifacts.json"],this._jsonFolder="jsons/",this._scriptFiles=["input.js","loop.js","level.js","entity.js","artifact.js","bot.js","god.js","sky.js","plane.js","camera.js","player.js"],this._scriptFolder="scripts/"};Candle.PPU=128,Candle.prototype={get scriptSrcs(){var t=this,e=$.map(this._scriptFiles,function(e){return t._scriptFolder+e});return e},get imageFolder(){return this._imageFoler},get imageFiles(){return this._imageFiles},get jsonFiles(){return this._jsonFiles},get jsonFolder(){return this._jsonFolder},get imageSrcs(){var t=this,e=$.map(this._imageFiles,function(e){return t._imageFoler+e});return e},get canvas(){return this._canvas},get images(){return this._images},get jsons(){return this._jsons},get ctx(){return this._ctx}},Candle.prototype.setCanvas=function(t){this._canvas=document.getElementById(t.id||"display"),this._canvas.width=t.width||640,this._canvas.height=t.height||480,this._canvas.style.display="block",this._canvas.style.margin="auto",this._canvas.style.background="#f0f0f0",this._ctx=this._canvas.getContext("2d")},Candle.prototype.about=function(){console.log(this._about)},Candle.prototype.init=function(t){this._scripts.push.apply(this._scripts,t)},Candle.prototype.loadScripts=function(t,e){var s=0,n=t[s],i=function(){++s===t.length?e():(n=t[s],loadJS(n,i))};loadJS(n,i)},Candle.prototype.loadImages=function(t,e,s){for(var n=e.length,i=function(){n--,0===n&&s()},o=0;o<e.length;o++){var a=new Image,r=e[o];this._images[r]=a,a.onload=i,a.src=t+r}},Candle.prototype.loadJsons=function(t,e,s){for(var n=e.length,i=this,o=function(){i._jsons[this.fileName]=JSON.parse(this.responseText),n--,0===n&&s()},a=0;a<e.length;a++){var r=e[a],c=t+r,l=new XMLHttpRequest;l.fileName=r,l.onload=o,l.open("GET",c),l.send()}},Candle.prototype.load=function(){var t=this;t.about(),t.loadScripts(t.scriptSrcs,function(){t.loadImages(t.imageFolder,t.imageFiles,function(){t.loadJsons(t.jsonFolder,t.jsonFiles,function(){t.wolf3d()})})})},Candle.prototype.wolf3d=function(){var t=this.jsons["Wolf08.json"],e=new Input,s=new Loop,n=new Player("larry");n.setPosition(24.5,24.5),n.setTheta(0);var i=this.ctx;n.control=function(){var t=e.states,s=.005*(t.up-t.down),n=.002*(t.right-t.left);this.setOmega(n),this.setSpeed(s)};var o=this.canvas,a=new Plane(o,t.ceiling,t.floor,this.images["tiles.png"],64,t.grids),r=new Camera(o,2,32,.8,a),c={info:this.jsons["artifacts.json"],texture:this.images["artifacts.png"]},l=new God(o,c,null,64,t.grids);n.bindActionKey("space",1e3,function(){l.render()}),s.start(function(t){function s(t,e){return t.distance<e.distance?1:t.distance>e.distance?-1:0}n.control(),n.motion(t),n.onActionKey("space",e.states.space,t),a.render(),r.castRays(n,a),l.viewFrom(n,.8);var o=r.render(),c=l.render(),h=[];for(var d in o){var u=o[d];u&&h.push(u)}for(var p in c){var f=c[p];f&&h.push(f)}h.sort(s);for(var g in h){var j=h[g];i.drawImage(j.texture,j.sx,j.sy,j.sw,j.sh,j.dx,j.dy,j.dw,j.dh)}})};