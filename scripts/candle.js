var Candle=function(s,t){this._about="This project is based on candle.js",this._entities=[],this._images={},this._jsons={},this._sounds={},this._assets=s,this.setCanvas(t),this._loop=null};Candle.PPU=128,Candle.prototype={get assets(){return this._assets},get canvas(){return this._canvas},get images(){return this._images},get jsons(){return this._jsons},get sounds(){return this._sounds},get ctx(){return this._ctx},get input(){return this._input},get loop(){return this._loop}},Candle.prototype.setCanvas=function(s){this._canvas=document.getElementById(s.id||"display"),this._canvas.width=s.width||640,this._canvas.height=s.height||480,this._canvas.style.position=s.position,this._canvas.style.top=s.top,this._canvas.style.left=s.left,this._canvas.style.display="block",this._canvas.style.background="#000000",this._ctx=this._canvas.getContext("2d")},Candle.prototype.about=function(){console.log(this._about)},Candle.prototype.loadScripts=function(s,t){var e=this,o=$.map(this.assets.scriptFiles,function(s){return e.assets.scriptFolder+s}),n=0,i=o[n],a=function(){++n===o.length?t():(s(e.assets.scriptFiles[n]),i=o[n],loadJS(i,a))};loadJS(i,a)},Candle.prototype.loadImages=function(s,t){for(var e=this,o=this.assets.imageFolder,n=this.assets.imageFiles,i=n.length,a=function(){s(e.assets.imageFiles[i]),i--,0===i&&t()},l=0;l<n.length;l++){var d=new Image,c=n[l];this._images[c]=d,d.onload=a,d.src=o+c}},Candle.prototype.loadJsons=function(s,t){for(var e=this,o=this.assets.jsonFolder,n=this.assets.jsonFiles,i=n.length,a=function(){e._jsons[this.fileName]=JSON.parse(this.responseText),i--,s(e.assets.jsonFiles[i]),0===i&&t()},l=0;l<n.length;l++){var d=n[l],c=o+d,r=new XMLHttpRequest;r.fileName=d,r.onload=a,r.open("GET",c),r.send()}},Candle.prototype.loadSounds=function(s,t){for(var e=this,o=this.assets.soundFiles,n=this.assets.soundFolder,i=o.length,a=function(){i--,s(e.assets.soundFiles[i]),0===i&&t()},l=0;l<o.length;l++){var d=o[l],c=n+d,r=new Audio;r.addEventListener("canplaythrough",a,!1),r.src=c,r.load(),document.body.appendChild(r),this._sounds[d]=r}},Candle.prototype.load=function(s,t,e){var o=this;o.about(),o.test(),o.loadScripts(t,function(){console.log("scripts did load"),o.loadImages(t,function(){console.log("images did load"),o.loadJsons(t,function(){console.log("jsons did load"),o.loadSounds(t,function(){console.log("sounds did load"),o._input=new Input,o._loop=s.call(o),e()})})})})},Candle.prototype.test=function(){void 0===this.assets.scriptFolder&&console.log("scriptFolder: ",this.assets.scriptFolder),void 0===this.assets.scriptFiles&&console.log("scriptFiles: ",this.assets.scriptFiles),void 0===this.assets.imageFolder&&console.log("imageFolder: ",this.assets.imageFolder),void 0===this.assets.imageFiles&&console.log("imageFiles: ",this.assets.imageFiles),void 0===this.assets.jsonFolder&&console.log("jsonFolder: ",this.assets.jsonFolder),void 0===this.assets.jsonFiles&&console.log("jsonFiles: ",this.assets.jsonFiles),void 0===this.assets.soundFolder&&console.log("soundFolder: ",this.assets.soundFolder),void 0===this.assets.soundFiles&&console.log("soundFiles: ",this.assets.soundFiles)},Candle.prototype.render=function(s,t){function e(s,t){return s.distance<t.distance?1:s.distance>t.distance?-1:0}var o=this.ctx;o.save();var n=[];for(var i in s){var a=s[i];a&&n.push(a)}for(var l in t){var d=t[l];d&&n.push(d)}n.sort(e);for(var c in n){var r=n[c];o.drawImage(r.texture,r.sx,r.sy,r.sw,r.sh,r.dx,r.dy,r.dw,r.dh)}o.restore()};