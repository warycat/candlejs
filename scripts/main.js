function onProgress(e){$("#message").text("Loading: "+e)}var candle=new Candle,assets={scriptFolder:"scripts/",scriptFiles:["keyboard.js","loop.js","level.js","entity.js","artifact.js","bot.js","god.js","sky.js","plane.js","camera.js","player.js","label.js","sprite.js"],soundFolder:"sounds/",soundFiles:["gangnam.mp3","shotgun-reload.mp3","shotgun-fire.mp3"],jsonFolder:"jsons/",jsonFiles:["levels.json","Wolf08.json","artifacts.json","gangnamAtlas.json","gangnamLevel.json","gangnamAnimations.json"],imageFolder:"images/",imageFiles:["sky1.jpg","wall_texture.jpg","tiles.png","artifacts.png","gangnam.png","pistol.png"]};candle.setAssets(assets);var canvasConfig;candle.mobileAndTabletcheck()?(canvasConfig={id:"mobile-display",width:$(window).width(),height:$(window).height()},$("#web").remove()):(canvasConfig={id:"web-display",width:290,height:506,position:"relative",top:"-622px",left:"224px"},$("#mobile").remove()),candle.setCanvas(canvasConfig);var gangnam=function(){var e=this,s=e.canvas,t=e.keyboard;e.scoreLable=new Label(s,s.width/2,s.height/10,"20px Arial","center","white"),e.score=0,e.scoreText="Score: ";var a,n=new Sprite(s,this.images["pistol.png"],5,50,128,128,s.width/2,s.height,.5,1),i=this.jsons["gangnamLevel.json"],o=new Plane(s,i.ceiling,i.floor,this.images["tiles.png"],64,i.grids),r=new Camera(s,2,32,.8,o),d={info:this.jsons["artifacts.json"],texture:this.images["artifacts.png"]},h={500:{name:"Gangnam",tag:500,texture:this.images["gangnam.png"],atlas:this.jsons["gangnamAtlas.json"],animations:this.jsons["gangnamAnimations.json"]}},g=new God(s,d,h,64,i.grids),m=g.bots,l=[],c=function(s){switch(this.state){case 0:this.damaged=!1,this.state=1,this.setAnimation("step1"),this.setSpeed(.003),this.ms=0;break;case 1:this.damaged=!1,this.ms>5e3&&(this.ms=0,this.state=2,this.setAnimation("step2"),this.setSpeed(-.003)),this.ms+=s;break;case 2:this.damaged=!1,this.ms>5e3&&(this.ms=0,this.state=3,this.setAnimation("step3"),this.setSpeed(0)),this.ms+=s;break;case 3:if(this.damaged){e.score+=Math.ceil(this.duration),this.duration*=.8,this.state=4,this.setAnimation("step4"),this.setSpeed(0);break}this.ms>this.duration&&(this.ms=0,this.state=1,this.setAnimation("step1"),this.setSpeed(.003)),this.ms+=s;break;case 4:this.damaged=!1,this.ms>2e3&&(this.ms=0,this.state=3,this.setAnimation("step3"),this.setSpeed(0)),this.ms+=s}},p=function(){this.damaged=!0};for(a=0;a<m.length;a++){var u=m[a];500===u.tag&&(u.state=0,u.dance=c,u.duration=1e4,u.damage=p,l.push(u))}var f=new Player("larry");f.setPosition(12,12),f.setTheta(Math.PI),f.control=function(){var e=candle.touchStatus,s=t.states,a=.005*(s.up-s.down+e.UP-e.DOWN),n=.002*(s.right-s.left+e.RIGHT-e.LEFT);this.setOmega(n),this.setSpeed(a)},f.fire=function(){for(a=0;a<m.length;a++)u=m[a],500===u.tag&&f.alpha(u.position)<.1&&u.damage();n.animateOnce(),e.sounds["gangnam.mp3"].play(),e.sounds["shotgun-fire.mp3"].play(),setTimeout(function(){e.sounds["shotgun-reload.mp3"].play()},1e3)},f.bindActionKey("space",1e3,f.fire),candle.bindTapAction(f.fire);var j=new Loop(function(s){for(f.control(),f.motion(s),f.onActionKey("space",t.states.space,s),a=0;a<l.length;a++){var i=l[a];i.dance(s),i.move(s)}o.render(),r.castRays(f,o),g.animate(s),g.viewFrom(f,.8);var d=r.render(),h=g.render();e.render(d,h),e.scoreLable.render(e.scoreText+e.score),n.render(s)});return j};candle.load(gangnam,onProgress,function(){candle.mobileAndTabletcheck()?($("#message").text("Candle.js Ready. Touch to Fire"),document.addEventListener("touchend",function(){$("#message").remove(),$("#loader").remove(),candle.loop.start()})):($("#message").text("Candle.js Ready. SPACE to Fire"),$("#loader").click(function(){$("#message").remove(),$("#loader").remove(),candle.loop.start()}))});